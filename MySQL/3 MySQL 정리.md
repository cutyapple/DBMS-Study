### TCL (Transaction Control Language)



* **트랜잭션 (Transaction)** : DB의 상태를 변화시키는 하나의 **논리적 기능을 수행하기 위한 작업의 단위**. 한꺼번에 모두 수행 되어야 할 일련의 연산들.
* TCL 예시
  1. SELECT 문
     * 부모님 계좌, 자식 계좌 검색
  2. UPDATE 문
     * 부모님 계좌에서 인출
  3. UPDATE 문
     * 자식 계좌에 입금
     * **(그런데 중간에 에러가 나버린다면? => 트랜잭션 전의 상태로 되돌림!!**)
  4. SELECT 문
     * 부모님, 자식 계좌 검색
* **MySQL 구조**
  * 서버엔진
    * 쿼리 파싱
      * 파싱) 코드 분석
    * 데이터 요청
  * 스토리지엔진
    * 실제 데이터를 읽어오거나 씀
    * **여기서 트랜잭션을 처리함**
  * DB



* **스토리지 엔진의 종류 확인**

  * 9개의 엔진이 있다. 
  * InnoDB, MRG_MYISAM, MEMORY, BLACKHOLE, MYISAM, CSV, ARCHIVE, PERFORMANCE_SCHEMA, FEDERATED
  * 각 테이블에 맞게 엔진의 특성과 잘 맞게 확인해야 함.
  * InnoDB, MYISAM을 많이 사용함.
  * InnoDB가 Default Engine이다.

  

  | 엔진   | 특징                                                         | 기타                                    |
  | ------ | ------------------------------------------------------------ | --------------------------------------- |
  | iSAM   | MySQL 5.0 이전의 기본 엔진                                   |                                         |
  | MyiSAM | MySQL 5.1 까지의 기본 엔진, 트랜젝션 미지원                  | 읽기 전용 또는 읽기 작업일 때 주로 사용 |
  | InnoDB | MySQL 5.5 이후의 기본 엔진, 커밋, 롤백 및 크래시 복구 시능을 갖충 MySQL용 트랜잭션 엔진 | 가장 많이 사용함                        |
  | MEMORY | 모든 데이터를 RAM에 저장, Heap 엔진으로 알려져있다.          | NOBCLUSERT 환경에서 사용됨              |
  | MERGE  | MyiSAM의 여러 개의 테이블을 하나의 테이블처럼 다룬다.        | VLDB 환경에 적합                        |
  |        |                                                              |                                         |



* **사용자변수/시스템변수**
  * 시스템변수는 전역 변수의 의미를 가지고 있다.
  * @@ 접두사를 사용한다. 



* **autocommit**
  * 1이면 설정되어 있다. 
  * 쿼리문을 할 때마다 DB에 commit을 하는 것이다. 
  * 실수로 테이블을 날렸다면, 복구가 불가능하다. (신중해라 아가야)
  * `SELECT @@AUTOCOMMIT`을 이용하여 사용한다.
  * SET을 할 때에는 @@ 접두사를 붙이지 않는데, 그때는 변수로 취급되기 때문이다.



* **transaction**
  * `start transaction`으로 트랜잭션을 시작하고 `ROLLBACK`으로 롤백한다. 



* **테이블 복사**
  * `CREATE TABLE 테이블명 (SELECT 복사할열 FROM 기존테이블)`
  * 새 테이블에 기존 테이블의 전체 열을 선택하여 복사할 수 있다.



* **SELECT 문**
  * FROM  : 테이블을 선택함 
  * WHERE : 조건에 해당하는 테이블의 특정 부분을 선택함 
  * GROUP BY :  그룹핑을 한다. **직계 함수**(모아서 계산하는)를 반드시 사용해야 한다.
    * 직계 함수
      * AVG : 평균
      * MIN : 최소
      * MAX : 최대
      * COUNT(DISTINCT) : 중복 1개만 인정
      * SUM : 합
      * COUNT : (열)개수
  * HAVING : 또 다시 조건을 부여함.
  * ORDER BY : 정렬.
  * LIMIT : 끝에서/앞에서 부터 몇줄쯤 가져옴.

